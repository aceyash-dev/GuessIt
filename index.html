<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#f8fafc">
  <title>Guess It! 1.3.13</title>

  <!-- LIBS -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    /* --- VARIABLES (Light Mode Default) --- */
    :root {
      --bg: #f8fafc;
      --card: rgba(255, 255, 255, 0.9);
      --border: rgba(99, 102, 241, 0.15);
      --text: #0f172a;
      --text-muted: #64748b;
      --primary: #6366f1;
      --primary-glow: rgba(99, 102, 241, 0.3);
      --accent: #f43f5e;
      --gold: #f59e0b;
      --font-head: 'Space Grotesk', sans-serif;
      --font-body: 'Outfit', sans-serif;
      --modal-bg: #ffffff;
      --input-bg: #f1f5f9;
      --dock-bg: rgba(255, 255, 255, 0.95);
    }

    /* DARK MODE */
    body.dark-mode {
      --bg: #030712;
      --card: rgba(20, 25, 40, 0.9);
      --border: rgba(99, 102, 241, 0.3);
      --text: #f8fafc;
      --text-muted: #94a3b8;
      --primary-glow: rgba(99, 102, 241, 0.5);
      --gold: #fbbf24;
      --modal-bg: #0f172a;
      --input-bg: rgba(255,255,255,0.05);
      --dock-bg: rgba(15, 23, 42, 0.95);
    }

    /* THEMES */
    body[data-theme="Gold"] { --bg: #fffbeb; --card: rgba(255, 251, 235, 0.95); --primary: #d97706; --border: #d97706; }
    body.dark-mode[data-theme="Gold"] { --bg: #1a1200; --card: rgba(40,30,10,0.95); --primary: #fbbf24; --border: #fbbf24; }
    body[data-theme="Matrix"] { --bg: #000; --card: rgba(0,20,0,0.95); --primary: #00ff41; --border: #008f11; --text: #e0f2fe; }
    body.dark-mode[data-theme="Matrix"] { --bg: #000; --text: #00ff41; }

    /* --- BASE --- */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: var(--font-body); user-select: none; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; font-size: 14px; position: relative; transition: background 0.3s, color 0.3s; }

    /* --- ANIMATIONS --- */
    .bg-fx { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 50% 0%, var(--primary-glow) 0%, transparent 60%); opacity: 0.6; pointer-events: none; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    
    /* --- TOASTS --- */
    #toastContainer {
        position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
        z-index: 99999; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 350px; pointer-events: none;
    }
    .toast {
        background: var(--modal-bg); color: var(--text); border: 1px solid var(--border);
        padding: 12px 16px; border-radius: 12px; font-weight: 600; font-size: 13px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 10px;
        animation: toastIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); pointer-events: auto;
    }
    .toast.success { border-left: 4px solid #10b981; }
    .toast.error { border-left: 4px solid #ef4444; }
    .toast.info { border-left: 4px solid var(--primary); }
    @keyframes toastIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes toastOut { to { opacity: 0; transform: translateY(-20px); } }

    /* --- LAYOUT --- */
    .app { max-width: 480px; margin: 0 auto; height: 100%; display: flex; flex-direction: column; opacity: 0; transition: opacity 0.5s; }
    .app.loaded { opacity: 1; }
    .content { flex: 1; overflow-y: auto; padding: 20px 20px 100px 20px; scroll-behavior: smooth; }
    .content::-webkit-scrollbar { display: none; }

    /* --- UI ELEMENTS --- */
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 20px; margin-bottom: 15px; backdrop-filter: blur(12px); box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    
    .btn { background: var(--input-bg); color: var(--text); border: 1px solid var(--border); padding: 14px; border-radius: 16px; font-weight: 700; cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; font-family: var(--font-head); font-size: 13px; text-transform: uppercase; transition: 0.2s; touch-action: manipulation; }
    .btn:active { transform: scale(0.96); }
    .btn-primary { background: var(--primary); border: none; color: white; box-shadow: 0 4px 15px var(--primary-glow); }
    .btn-gold { background: linear-gradient(45deg, #f59e0b, #fbbf24); color: black; border:none; box-shadow: 0 4px 15px var(--gold-glow); }
    .btn-social { justify-content: flex-start; margin-bottom: 8px; font-size: 12px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text); }

    /* --- SPLASH SCREEN (RESTORED CUBE) --- */
    .splash { position: fixed; inset: 0; z-index: 2147483640; background: #020617; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.5s; }
    
    /* Dynamic Color Shifting BG */
    .splash-bg { 
        position: absolute; inset: -50%; 
        background: radial-gradient(circle, rgba(99,102,241,0.4) 0%, transparent 60%); 
        animation: hueAnim 10s infinite linear, rotAnim 20s infinite linear; 
        opacity: 0.4; z-index: -1;
    }
    @keyframes hueAnim { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }
    @keyframes rotAnim { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* 3D CUBE */
    .cube-wrap { perspective: 800px; width: 60px; height: 60px; margin-bottom: 30px; position: relative; z-index: 10; }
    .cube { width: 100%; height: 100%; transform-style: preserve-3d; animation: spin 6s infinite linear; }
    .face { position: absolute; width: 60px; height: 60px; background: rgba(99,102,241,0.1); border: 2px solid var(--primary); display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 900; color: white; box-shadow: 0 0 20px var(--primary-glow); }
    .f1 { transform: translateZ(30px); } .f2 { transform: rotateY(180deg) translateZ(30px); }
    .f3 { transform: rotateY(90deg) translateZ(30px); } .f4 { transform: rotateY(-90deg) translateZ(30px); }
    .f5 { transform: rotateX(90deg) translateZ(30px); } .f6 { transform: rotateX(-90deg) translateZ(30px); }
    @keyframes spin { 0% { transform: rotateX(0) rotateY(0); } 100% { transform: rotateX(360deg) rotateY(360deg); } }

    .loading-bar-wrap { width: 200px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 20px; overflow: hidden; position: relative; z-index: 10; }
    .loading-bar { width: 0%; height: 100%; background: var(--primary); transition: width 0.1s; }
    .loading-text { font-family: var(--font-head); font-size: 10px; margin-top: 10px; color: rgba(255,255,255,0.7); letter-spacing: 2px; z-index: 10; }
    
    .enter-btn { 
        margin-top: 40px; padding: 16px 60px; border: 2px solid var(--primary); 
        background: rgba(0,0,0,0.5); color: white; font-family: var(--font-head); 
        letter-spacing: 3px; font-weight: bold; cursor: pointer; 
        z-index: 2147483647; border-radius: 50px; 
        box-shadow: 0 0 30px var(--primary-glow); 
        animation: pulse 2s infinite; display: none;
    }

    /* --- FEATURES --- */
    .mission-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); }
    
    .wheel-wrapper { width: 260px; height: 260px; margin: 20px auto; border-radius: 50%; border: 5px solid var(--card); box-shadow: 0 0 30px rgba(0,0,0,0.2); position: relative; overflow: hidden; }
    .wheel { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(var(--accent) 0deg 60deg, var(--primary) 60deg 120deg, var(--gold) 120deg 180deg, #10b981 180deg 240deg, #a855f7 240deg 300deg, #3b82f6 300deg 360deg); transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); will-change: transform; }
    .wheel-arrow { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 25px solid var(--text); z-index: 10; }

    /* --- DOCK & MODALS --- */
    .dock-container { position: fixed; bottom: 20px; left: 0; width: 100%; display: flex; justify-content: center; z-index: 100; pointer-events: none; }
    .dock { background: var(--dock-bg); backdrop-filter: blur(20px); padding: 12px 25px; border-radius: 24px; display: flex; gap: 40px; border: 1px solid var(--border); pointer-events: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
    .dock i { font-size: 22px; color: var(--text-muted); transition: 0.3s; cursor: pointer; }
    .dock i.active { color: var(--primary); transform: translateY(-5px); }

    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 2000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; backdrop-filter: blur(8px); }
    .overlay.open { opacity: 1; pointer-events: auto; }
    .modal { background: var(--modal-bg); width: 90%; max-width: 380px; padding: 25px; border-radius: 28px; border: 1px solid var(--border); text-align: center; transform: scale(0.9); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); max-height: 85vh; overflow-y: auto; color: var(--text); box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
    .overlay.open .modal { transform: scale(1); }

    /* --- UTILS --- */
    .tab-view { display: none; opacity: 0; transform: translateY(10px); transition: opacity 0.3s, transform 0.3s; }
    .tab-view.active { display: block; opacity: 1; transform: translateY(0); }
    
    .currency-pill { background: var(--input-bg); border: 1px solid var(--border); padding: 5px 12px; border-radius: 20px; font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer; font-weight: bold; }
    .custom-input { width: 100%; background: var(--input-bg); border: 1px solid var(--border); padding: 14px; border-radius: 14px; color: var(--text); outline: none; margin-top: 5px; }
    .custom-input:focus { border-color: var(--primary); background: var(--card); }
    
    /* Grid & Items */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .item-box { background: var(--input-bg); border: 1px solid var(--border); padding: 12px; border-radius: 16px; text-align: center; cursor: pointer; transition: 0.2s; position: relative; }
    .item-box:active { transform: scale(0.95); }
    .item-preview { width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--border); margin: 5px auto; }
    .item-qty { position: absolute; top: -5px; right: -5px; background: var(--primary); color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    
    /* Calendar Day */
    .cal-day { padding:10px; border:1px solid var(--border); border-radius:8px; text-align:center; position:relative; background: var(--input-bg); }
    .cal-day.active { border-color:var(--primary); background:var(--primary-glow); }
    .cal-day.claimed { opacity:0.5; }
    .cal-val { font-weight:bold; font-size:12px; margin-top:4px; display:block; }
  </style>
</head>
<body>
  
  <div id="toastContainer"></div>
  <div class="bg-fx"></div>

  <!-- AUDIO -->
  <audio id="bgMusic_smooth" loop preload="auto"><source src="no-copyright-gaming-background-music-for-minecraftgaming-405002.mp3" type="audio/mpeg"></audio>
  <audio id="bgMusic_montagem" loop preload="auto"><source src="MONTAGEM XONADA.mp3" type="audio/mpeg"></audio>
  <audio id="bgMusic_sigilo" loop preload="auto"><source src="FUNK SIGILO SLOWED.mp3" type="audio/mpeg"></audio>
  <audio id="bgMusic_sempero" loop preload="auto"><source src="SEMPERO_Slowed_KLICKAUD.mp3" type="audio/mpeg"></audio>

  <!-- SPLASH -->
  <div class="splash" id="splash">
    <div class="splash-bg"></div>
    <div class="cube-wrap"><div class="cube"><div class="face f1">G</div><div class="face f2">?</div><div class="face f3">!</div><div class="face f4">#</div><div class="face f5"></div><div class="face f6"></div></div></div>
    <h1 style="font-size: 32px; font-weight: 800; letter-spacing: 4px; margin-bottom: 5px; color:white; text-shadow:0 0 20px black;">GUESSIT!</h1>
    <div style="color:rgba(255,255,255,0.7); font-size: 12px; letter-spacing: 2px;">V1.3.13</div>
    <div style="width:200px; height:4px; background:rgba(255,255,255,0.2); border-radius:10px; margin-top:30px; overflow:hidden;" id="loadWrap">
        <div id="loadBar" style="width:0%; height:100%; background:var(--primary); transition:width 0.1s;"></div>
    </div>
    <div id="loadText" style="color:rgba(255,255,255,0.5); font-size:10px; margin-top:10px;">LOADING...</div>
    <button class="enter-btn" id="enterBtn" onclick="initApp()">START SYSTEM</button>
  </div>

  <!-- APP -->
  <div class="app" id="app">
    
    <!-- HEADER -->
    <div style="padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
        <div style="font-family: var(--font-head); font-weight: 800; font-size: 18px; display: flex; align-items: center; gap: 10px;">
            <i class="fa-solid fa-cube" style="color:var(--primary)"></i> GUESSIT!
        </div>
        <div style="display:flex; gap:8px;">
            <div class="currency-pill"><i class="fa-solid fa-coins" style="color:var(--gold)"></i> <span id="uiCoins">0</span></div>
            <div class="currency-pill"><i class="fa-regular fa-gem" style="color:#38bdf8"></i> <span id="uiGems">0</span></div>
        </div>
    </div>

    <div class="content">
        
        <!-- HOME TAB -->
        <div id="tab-home" class="tab-view active">
            <!-- EVENT -->
            <div id="eventCard" class="card" style="background: linear-gradient(135deg, #4f46e5, #9333ea); color:white; border:none; display:none;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-size:10px; opacity:0.8; background:rgba(0,0,0,0.3); width:fit-content; padding:2px 6px; border-radius:4px; margin-bottom:5px;">HARDCORE</div>
                        <h3>Guesser! Event</h3>
                    </div>
                    <i class="fa-solid fa-stopwatch" style="font-size:30px; opacity:0.5;"></i>
                </div>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button class="btn" style="padding:8px 16px; font-size:11px; width:auto; border:none; background:rgba(255,255,255,0.2); color:white;" onclick="eventCheckIn()">Check In</button>
                    <button class="btn" style="padding:8px 16px; font-size:11px; width:auto; border:none; background:white; color:var(--primary);" onclick="startGame('hardcore')">Play</button>
                </div>
            </div>

            <!-- HERO -->
            <div class="card" style="margin-top:10px;">
                <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                    <div>
                        <div style="font-size:10px; color:var(--text-muted); text-transform:uppercase;">Level Progress</div>
                        <div style="font-size:24px; font-weight:900;">Lvl <span id="lvlDisplay">1</span></div>
                    </div>
                    <div style="text-align:right;"><span style="font-size:11px; opacity:0.8;" id="xpText">0 XP</span></div>
                </div>
                <div style="width:100%; height:6px; background:var(--input-bg); border-radius:10px; margin-top:10px;">
                    <div id="xpBar" style="height:100%; background:var(--primary); width:0%; border-radius:10px;"></div>
                </div>
                <button class="btn btn-primary" style="margin-top:15px;" onclick="startGame('classic')"><i class="fa-solid fa-play"></i> PLAY CLASSIC</button>
            </div>

            <!-- DAILY MISSIONS -->
            <div class="card" style="padding:0; overflow:hidden;">
                <div style="padding:15px; border-bottom:1px solid var(--border); font-weight:bold; font-size:12px;">DAILY MISSIONS</div>
                <div id="missionList"></div>
            </div>
        </div>

        <!-- SHOP TAB -->
        <div id="tab-shop" class="tab-view">
            <h2 style="margin-bottom:15px;">Marketplace</h2>
            
            <div class="grid-2" style="margin-bottom:15px;">
                <button class="btn" onclick="openModal('calendarModal')"><i class="fa-solid fa-calendar-check" style="color:var(--gold)"></i> Calendar</button>
                <button class="btn" onclick="openModal('spinnerModal')"><i class="fa-solid fa-dharmachakra" style="color:var(--accent)"></i> Spinner</button>
            </div>

            <div class="card" style="background:linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(0,0,0,0)); border-color:var(--gold);">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div><h3 style="color:var(--gold)">GOLD PASS</h3><div style="font-size:10px;">2x Rewards (7 Days)</div></div>
                    <button class="btn btn-gold" style="width:auto;" onclick="buyItem('gold_pass')">99 <i class="fa-regular fa-gem"></i></button>
                </div>
            </div>

            <h4 style="margin:15px 0 10px; color:var(--text-muted); font-size:12px;">ITEMS</h4>
            <div class="shop-grid grid-2" id="shopConsumables"></div>
            <h4 style="margin:15px 0 10px; color:var(--text-muted); font-size:12px;">THEMES & COSMETICS</h4>
            <div class="shop-grid grid-2" id="shopCosmetics"></div>
        </div>

        <!-- PROFILE TAB -->
        <div id="tab-profile" class="tab-view">
            <div class="card" style="text-align:center;">
                <div style="position:absolute; top:15px; right:15px;" onclick="openModal('settingsModal')"><i class="fa-solid fa-gear"></i></div>
                <img id="profileAvatar" src="" style="width:80px; height:80px; border-radius:50%; border:2px solid var(--primary); margin-bottom:10px; object-fit:cover;">
                <h2 id="profileName">Guest</h2>
                <div id="profileBio" style="font-size:12px; color:var(--text-muted); margin-bottom:15px;">...</div>
                
                <div class="grid-2">
                    <div style="background:var(--input-bg); padding:10px; border-radius:12px;">
                        <div style="font-size:16px; font-weight:800;" id="stWins">0</div><div style="font-size:10px;">Wins<br><span style="font-size:8px; opacity:0.7">Total Rounds Won</span></div>
                    </div>
                    <div style="background:var(--input-bg); padding:10px; border-radius:12px;">
                        <div style="font-size:16px; font-weight:800;" id="eventScore">0</div><div style="font-size:10px;">Crystals<br><span style="font-size:8px; opacity:0.7">From Events</span></div>
                    </div>
                    <div style="background:var(--input-bg); padding:10px; border-radius:12px;">
                        <div style="font-size:16px; font-weight:800;" id="stWinRate">0%</div><div style="font-size:10px;">Win Rate<br><span style="font-size:8px; opacity:0.7">Accuracy</span></div>
                    </div>
                    <div style="background:var(--input-bg); padding:10px; border-radius:12px;">
                        <div style="font-size:16px; font-weight:800;" id="stTime">0m</div><div style="font-size:10px;">Play Time<br><span style="font-size:8px; opacity:0.7">Total Time</span></div>
                    </div>
                </div>
                
                <div id="loginPrompt" style="margin-top:20px;">
                    <button class="btn btn-primary" onclick="openModal('authModal')">Login / Signup</button>
                </div>
                <div class="grid-2" style="margin-top:10px;">
                    <button class="btn" onclick="openModal('setupModal')">Edit Profile</button>
                    <button class="btn" onclick="openModal('inventoryModal')">Inventory</button>
                </div>
            </div>
        </div>

    </div>

    <!-- DOCK -->
    <div class="dock-container">
        <div class="dock">
            <i class="fa-solid fa-house active" onclick="nav('home', this)"></i>
            <i class="fa-solid fa-store" onclick="nav('shop', this)"></i>
            <i class="fa-solid fa-user" onclick="nav('profile', this)"></i>
        </div>
    </div>

  </div>

  <!-- --- MODALS --- -->

  <!-- AUTH -->
  <div class="overlay" id="authModal">
      <div class="modal">
          <h3>Account Access</h3>
          <div style="display:flex; flex-direction:column; gap:10px; margin-top:20px;">
              <button class="btn" onclick="showAuthInput('phone')"><i class="fa-solid fa-phone"></i> Continue with Phone</button>
              <button class="btn" onclick="showAuthInput('email')"><i class="fa-solid fa-envelope"></i> Continue with Email</button>
              <button class="btn" style="background:#fff; color:#000; border:1px solid #ddd;" onclick="firebaseLogin()"><i class="fa-brands fa-google"></i> Google</button>
              <button class="btn" onclick="fakeLogin('Guest')">Continue as Guest</button>
          </div>
          <div id="authInputs" style="display:none; margin-top:15px; border-top:1px solid var(--border); padding-top:15px;">
              <input type="text" id="authField" class="custom-input" placeholder="...">
              <button class="btn btn-primary" style="margin-top:10px;" onclick="fakeLogin('Verified')">Verify & Login</button>
          </div>
          <button class="btn" style="margin-top:10px; border:none;" onclick="closeModal('authModal')">Close</button>
      </div>
  </div>

  <!-- INVENTORY -->
  <div class="overlay" id="inventoryModal">
      <div class="modal"><h3>My Inventory</h3><div class="grid-2" id="invGrid" style="margin-top:15px;"></div><button class="btn" style="margin-top:20px;" onclick="closeModal('inventoryModal')">Close</button></div>
  </div>

  <!-- SPINNER -->
  <div class="overlay" id="spinnerModal">
      <div class="modal">
          <h3>Lucky Spin</h3>
          <div id="spinInfo" style="font-size:11px; margin-bottom:10px; color:var(--text-muted);">
              Cooldown: 24h â€¢ Cost: Free<br>Win up to 100 Coins!
          </div>
          <div class="wheel-wrapper"><div class="wheel-arrow"></div><div class="wheel" id="theWheel"></div></div>
          <button class="btn btn-primary" id="spinBtn" style="margin-top:20px;" onclick="spinWheel()">SPIN NOW</button>
          <button class="btn" style="margin-top:10px; border:none;" onclick="closeModal('spinnerModal')">Close</button>
      </div>
  </div>

  <!-- CALENDAR -->
  <div class="overlay" id="calendarModal">
      <div class="modal">
          <h3>Daily Login</h3>
          <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:5px; margin-top:15px;" id="calGrid"></div>
          <button class="btn btn-primary" id="claimCalBtn" style="margin-top:15px;" onclick="claimDaily()">Claim Reward</button>
          <button class="btn" style="margin-top:10px; border:none;" onclick="closeModal('calendarModal')">Close</button>
      </div>
  </div>

  <!-- GAME -->
  <div class="overlay" id="gameModal">
      <div class="modal">
          <div style="display:flex; justify-content:space-between; align-items:center;">
              <span id="gameModeBadge" style="font-size:10px; background:var(--accent); color:white; padding:2px 6px; border-radius:4px; display:none;">HARDCORE</span>
              <div id="gameTimer"></div>
              <i class="fa-solid fa-xmark" onclick="closeGameModal()" style="cursor:pointer; padding:5px;"></i>
          </div>
          <div style="width:160px; height:160px; background:white; border-radius:30px; margin:15px auto; padding:20px; display:flex; align-items:center; justify-content:center;">
              <img id="gameImg" style="width:100%; height:100%; object-fit:contain;">
          </div>
          <input type="text" id="gInput" class="custom-input" style="text-align:center; font-size:20px; text-transform:uppercase; letter-spacing:2px; margin-bottom:15px;" placeholder="LOGO NAME">
          <button class="btn btn-primary" onclick="submitGuess()">Submit Answer</button>
      </div>
  </div>

  <!-- SETUP -->
  <div class="overlay" id="setupModal">
      <div class="modal">
          <h3>Profile Setup</h3>
          <div style="display:flex; justify-content:center; align-items:center; gap:20px; margin:20px 0;">
              <i class="fa-solid fa-chevron-left" onclick="cycleAvatar(-1)"></i>
              <img id="setupAvatar" src="" style="width:80px; height:80px; border-radius:50%; border:2px solid var(--primary); object-fit:cover;">
              <i class="fa-solid fa-chevron-right" onclick="cycleAvatar(1)"></i>
          </div>
          <div style="text-align:center; margin-bottom:15px;">
              <input type="file" id="avatarUpload" accept="image/*" style="display:none" onchange="uploadAvatar(this)">
              <button class="btn" style="font-size:10px; padding:6px 12px; width:auto;" onclick="document.getElementById('avatarUpload').click()">Upload Custom</button>
          </div>
          <input type="text" id="setupName" class="custom-input" placeholder="Username" maxlength="12">
          <input type="text" id="setupBio" class="custom-input" placeholder="Short Bio" maxlength="30">
          <button class="btn btn-primary" style="margin-top:20px" onclick="saveProfile()">Save Changes</button>
      </div>
  </div>

  <!-- SETTINGS -->
  <div class="overlay" id="settingsModal">
      <div class="modal">
          <h3>Settings</h3>
          <div style="margin:20px 0; text-align:left;">
              <label style="font-size:12px; color:var(--text-muted);">Audio Track</label>
              <select class="custom-input" id="bgmSelect" onchange="changeBGM(this.value)">
                  <option value="SMOOTH">Smooth (Default)</option>
                  <option value="MONTAGEM">Montagem Xonada</option>
                  <option value="SIGILO">Funk Sigilo</option>
                  <option value="SEMPERO">Sempero</option>
              </select>
          </div>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
              <span>Dark Mode</span>
              <button class="btn" style="width:auto; padding:5px 15px;" onclick="toggleDarkMode()"><i class="fa-solid fa-moon"></i></button>
          </div>
          <button class="btn" onclick="toggleSetting('music')">Music: <span id="stMusic">OFF</span></button>
          <button class="btn" style="margin-top:10px;" onclick="toggleSetting('sfx')">SFX: <span id="stSfx">ON</span></button>
          <a href="https://www.bit.ly/m/aceyash" target="_blank" class="btn" style="margin-top:10px; text-decoration:none;">Help & Support</a>
          <button class="btn" style="margin-top:20px; border:none;" onclick="closeModal('settingsModal')">Close</button>
      </div>
  </div>

  <script>
    // --- CONFIG & DATA ---
    const firebaseConfig = { apiKey: "AIzaSyAbKxS6HUPn1c632CMPzvLQiJBw57vqflQ", authDomain: "studio-4144954497-c3ea9.firebaseapp.com", projectId: "studio-4144954497-c3ea9", storageBucket: "studio-4144954497-c3ea9.firebasestorage.app", messagingSenderId: "167077162658", appId: "1:167077162658:web:1e622ae891c10b444cf1fb", measurementId: "G-YGGB0F12NL" };
    
    const LOGOS = [{n:'Apple',d:'apple.com'},{n:'Google',d:'google.com'},{n:'Microsoft',d:'microsoft.com'},{n:'Tesla',d:'tesla.com'},{n:'SpaceX',d:'spacex.com'},{n:'Netflix',d:'netflix.com'},{n:'Spotify',d:'spotify.com'},{n:'Twitter',d:'twitter.com'},{n:'Amazon',d:'amazon.com'},{n:'Nike',d:'nike.com'}];
    const AVATARS = ['Felix', 'Aneka', 'Zoe', 'Marc', 'Bear', 'Bandit', 'Bella', 'Buster'];
    const SHOP_ITEMS = [
        {id:'xp_card', n:'2x XP Card', type:'consumable', cost:50, currency:'coins', icon:'fa-bolt'},
        {id:'coin_card', n:'Coin Bag', type:'consumable', cost:50, currency:'gems', icon:'fa-sack-dollar'},
        {id:'th_gold', n:'Gold Theme', type:'cosmetic', cost:500, currency:'coins', val:'Gold', preview:'#fffbeb'},
        {id:'th_mat', n:'Matrix Theme', type:'cosmetic', cost:1000, currency:'coins', val:'Matrix', preview:'#000'}
    ];
    const CAL_REWARDS = [
        {t:'coins',v:50},{t:'coins',v:100},{t:'gems',v:10},{t:'coins',v:200},{t:'item',id:'xp_card'},{t:'gems',v:25},{t:'item',id:'th_gold'}
    ];

    // --- STATE ---
    let state = {
        user: { name: 'Guest', bio: 'Ready to play!', avatarIdx: 0, avatarCustom: null, uid: null },
        wallet: { coins: 100, gems: 10, eventCrystals: 0 },
        stats: { lvl: 1, xp: 0, wins: 0, played: 0, timePlayed: 0 },
        inventory: {},
        activeBoosts: { xp: 0, coins: 0 },
        goldPass: { active: false, expiry: 0 },
        event: { checkedIn: [] },
        daily: { lastLogin: 0, streak: 0, lastSpin: 0 },
        missions: [
            {id:'win3', desc:'Win 3 Games', target:3, prog:0, claimed:false, rwd:50},
            {id:'play5', desc:'Play 5 Games', target:5, prog:0, claimed:false, rwd:50},
            {id:'login', desc:'Daily Login', target:1, prog:0, claimed:false, rwd:20}
        ],
        lastMissionReset: 0,
        settings: { music: false, sfx: true, bgm: 'SMOOTH', theme: '', darkMode: false }
    };

    let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let currentAudio = null;
    let db = null;
    let gameTimerInterval = null;
    let currentGame = null;
    let isHardcore = false;

    // --- INIT ---
    window.onload = () => {
        let progress = 0;
        const interval = setInterval(() => {
            progress += 2;
            if(progress > 100) progress = 100;
            document.getElementById('loadBar').style.width = progress + '%';
            if(progress === 100) {
                clearInterval(interval);
                document.getElementById('loadText').innerText = "SYSTEM READY";
                document.getElementById('loadWrap').style.display = 'none';
                document.getElementById('enterBtn').style.display = 'block';
            }
        }, 30);

        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            firebase.auth().onAuthStateChanged(u => {
                if(u) { state.user.uid = u.uid; loadCloud(u.uid); document.getElementById('loginPrompt').style.display='none'; }
            });
        } catch(e) {}

        const s = localStorage.getItem('guessit_b13');
        if(s) state = { ...state, ...JSON.parse(s) };

        // Time Tracking
        setInterval(() => { state.stats.timePlayed++; if(state.stats.timePlayed%60===0) save(); }, 1000);

        checkMissionsReset();
        applySettings();
        checkEventValidity();
        renderAll();
    };

    function initApp() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        if(state.settings.music) setAudioSource(state.settings.bgm);
        document.getElementById('splash').style.opacity = 0;
        document.getElementById('splash').style.pointerEvents = 'none';
        setTimeout(() => document.getElementById('splash').style.display='none', 500);
        document.getElementById('app').classList.add('loaded');
    }

    // --- GAME ---
    function startGame(mode) {
        isHardcore = mode === 'hardcore';
        currentGame = LOGOS[Math.floor(Math.random()*LOGOS.length)];
        document.getElementById('gameImg').src = `https://logo.clearbit.com/${currentGame.d}`;
        document.getElementById('gInput').value = '';
        document.getElementById('gameModeBadge').style.display = isHardcore ? 'block' : 'none';
        
        openModal('gameModal');
        
        if(isHardcore) {
            let timeLeft = 15;
            document.getElementById('gameTimer').innerText = `${timeLeft}s`;
            clearInterval(gameTimerInterval);
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('gameTimer').innerText = `${timeLeft}s`;
                if(timeLeft <= 0) {
                    clearInterval(gameTimerInterval);
                    closeGameModal();
                    showToast("Time's Up!", "error");
                    state.stats.played++;
                    save(); renderAll();
                }
            }, 1000);
        } else {
            document.getElementById('gameTimer').innerText = '';
        }
    }

    function submitGuess() {
        const val = document.getElementById('gInput').value.trim().toLowerCase();
        state.stats.played++;
        if(val === currentGame.n.toLowerCase()) {
            clearInterval(gameTimerInterval);
            let xpGain = 50; let coinGain = 20;
            if(isHardcore) { xpGain *= 2; coinGain *= 2; state.wallet.eventCrystals += 5; }
            if(state.goldPass.active && Date.now() < state.goldPass.expiry) { xpGain *= 2; coinGain *= 2; }
            if(state.activeBoosts.xp > Date.now()) xpGain *= 2;
            
            state.wallet.coins += coinGain;
            state.stats.xp += xpGain;
            state.stats.wins++;
            
            updateMission('win3', 1);
            updateMission('play5', 1);

            if(state.stats.xp >= state.stats.lvl * 100) { state.stats.lvl++; showToast("Level Up!", "success"); }
            
            closeGameModal();
            showToast(`Correct! +${coinGain} Coins`, "success");
        } else {
            showToast("Wrong!", "error");
        }
        save(); renderAll();
    }
    
    function closeGameModal() { clearInterval(gameTimerInterval); closeModal('gameModal'); }

    // --- MISSIONS ---
    function checkMissionsReset() {
        const now = Date.now();
        if(now - state.lastMissionReset > 86400000) {
            state.missions.forEach(m => { m.prog = 0; m.claimed = false; });
            state.lastMissionReset = now;
            updateMission('login', 1);
        }
    }
    function updateMission(id, amt) {
        const m = state.missions.find(x => x.id === id);
        if(m && m.prog < m.target) {
            m.prog += amt;
            if(m.prog >= m.target) showToast("Mission Complete!", "success");
            save(); renderAll();
        }
    }
    function claimMission(id) {
        const m = state.missions.find(x => x.id === id);
        if(m && m.prog >= m.target && !m.claimed) {
            m.claimed = true;
            state.wallet.coins += m.rwd;
            showToast(`Claimed ${m.rwd} Coins`, "success");
            save(); renderAll();
        }
    }

    // --- SPINNER ---
    function spinWheel() {
        if(Date.now() - state.daily.lastSpin < 86400000) return showToast("Cooldown Active!", "error");
        document.getElementById('spinBtn').disabled = true;
        const wheel = document.getElementById('theWheel');
        const deg = 1800 + Math.floor(Math.random() * 360);
        wheel.style.transition = 'transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)';
        wheel.style.transform = `rotate(${deg}deg)`;
        
        setTimeout(() => {
            state.daily.lastSpin = Date.now();
            const rwd = Math.random() > 0.5 ? 100 : 50;
            state.wallet.coins += rwd;
            showToast(`You won ${rwd} Coins!`, "success");
            document.getElementById('spinBtn').disabled = false;
            wheel.style.transition = 'none';
            wheel.style.transform = 'rotate(0deg)';
            closeModal('spinnerModal');
            save(); renderAll();
        }, 4000);
    }

    // --- CALENDAR ---
    function checkCalendar() {
        const now = new Date();
        const last = new Date(state.daily.lastLogin);
        const dayDiff = Math.floor((now - last) / (1000 * 60 * 60 * 24));
        
        if(dayDiff > 1) state.daily.streak = 0;
        
        const grid = document.getElementById('calGrid');
        grid.innerHTML = '';
        for(let i=0; i<7; i++) {
            let rwd = CAL_REWARDS[i];
            let label = rwd.t === 'item' ? 'Item' : `${rwd.v} ${rwd.t === 'coins'?'Coins':'Gems'}`;
            let cls = 'cal-day';
            
            if(i < state.daily.streak) {
                grid.innerHTML += `<div class="${cls} claimed">Day ${i+1}<span class="cal-val">${label}</span></div>`;
            } else if (i === state.daily.streak) {
                grid.innerHTML += `<div class="${cls} active">Day ${i+1}<span class="cal-val">${label}</span></div>`;
            } else {
                grid.innerHTML += `<div class="${cls}">Day ${i+1}<span class="cal-val">${label}</span></div>`;
            }
        }
        
        const canClaim = dayDiff >= 1 || state.daily.lastLogin === 0;
        document.getElementById('claimCalBtn').disabled = !canClaim;
        openModal('calendarModal');
    }

    function claimDaily() {
        const day = state.daily.streak % 7;
        const rwd = CAL_REWARDS[day];
        if(rwd.t === 'coins') state.wallet.coins += rwd.v;
        if(rwd.t === 'gems') state.wallet.gems += rwd.v;
        if(rwd.t === 'item') addItem(rwd.id, 1);
        
        state.daily.streak++;
        state.daily.lastLogin = Date.now();
        showToast("Daily Reward Claimed!", "success");
        closeModal('calendarModal');
        save(); renderAll();
    }

    // --- SHOP & INVENTORY ---
    function buyItem(id) {
        if(id === 'gold_pass') {
            if(state.wallet.gems >= 99) { state.wallet.gems-=99; state.goldPass.active=true; state.goldPass.expiry=Date.now()+604800000; showToast("Gold Pass Active!", "success"); }
            else showToast("Not enough Gems", "error");
        } else {
            const i = SHOP_ITEMS.find(x=>x.id===id);
            const c = i.currency === 'coins' ? 'coins' : 'gems';
            if(state.wallet[c] >= i.cost) {
                state.wallet[c] -= i.cost;
                addItem(id, 1);
                if(i.type==='cosmetic') previewTheme(i.val, true); 
                showToast("Purchased!", "success");
            } else showToast("Insufficient Funds", "error");
        }
        save(); renderAll();
    }

    function addItem(id, qty) { if(!state.inventory[id]) state.inventory[id]=0; state.inventory[id]+=qty; }
    function useItem(id) {
        if(!state.inventory[id] || state.inventory[id]<=0) return;
        if(id === 'xp_card') { state.activeBoosts.xp = Date.now() + 1800000; showToast("XP Boost Active!", "success"); }
        if(id === 'coin_card') { state.wallet.coins += 200; showToast("+200 Coins", "success"); }
        state.inventory[id]--;
        save(); renderAll();
    }

    function previewTheme(themeVal, commit=false) {
        if(themeVal) {
            document.body.setAttribute('data-theme', themeVal);
            if(commit) { state.settings.theme = themeVal; save(); }
            else setTimeout(() => { if(state.settings.theme !== themeVal) document.body.setAttribute('data-theme', state.settings.theme); }, 3000);
        }
    }

    // --- RENDER ---
    function renderAll() {
        document.getElementById('uiCoins').innerText = state.wallet.coins;
        document.getElementById('uiGems').innerText = state.wallet.gems;
        document.getElementById('lvlDisplay').innerText = state.stats.lvl;
        document.getElementById('xpText').innerText = state.stats.xp + ' XP';
        document.getElementById('xpBar').style.width = Math.min(state.stats.xp % 100, 100) + '%';
        document.getElementById('profileName').innerText = state.user.name;
        document.getElementById('profileBio').innerText = state.user.bio;
        document.getElementById('stWins').innerText = state.stats.wins;
        document.getElementById('eventScore').innerText = state.wallet.eventCrystals;
        
        // Stats
        const wr = state.stats.played > 0 ? Math.round((state.stats.wins / state.stats.played) * 100) : 0;
        document.getElementById('stWinRate').innerText = wr + '%';
        
        const m = Math.floor(state.stats.timePlayed / 60);
        document.getElementById('stTime').innerText = m + 'm';

        // Inventory
        const invEl = document.getElementById('invGrid');
        invEl.innerHTML = '';
        Object.keys(state.inventory).forEach(k => {
            if(state.inventory[k] > 0) {
                const i = SHOP_ITEMS.find(x=>x.id===k);
                if(i || k.startsWith('th_')) {
                    const name = i ? i.n : k;
                    const icon = i ? i.icon : 'fa-box';
                    invEl.innerHTML += `<div class="item-box" onclick="useItem('${k}')"><i class="fa-solid ${icon}"></i><br>${name}<div class="item-qty">${state.inventory[k]}</div></div>`;
                }
            }
        });

        // Shop
        document.getElementById('shopConsumables').innerHTML = SHOP_ITEMS.filter(i=>i.type==='consumable').map(i=>`<div class="item-box" onclick="buyItem('${i.id}')"><i class="fa-solid ${i.icon}"></i><br>${i.n}<br><small>${i.cost} ${i.currency}</small></div>`).join('');
        document.getElementById('shopCosmetics').innerHTML = SHOP_ITEMS.filter(i=>i.type==='cosmetic').map(i=>`
            <div class="item-box" onclick="buyItem('${i.id}')">
                <div class="item-preview" style="background:${i.preview}" onclick="event.stopPropagation(); previewTheme('${i.val}')"></div>
                ${i.n}<br><small>${i.cost} Coins</small>
            </div>`).join('');

        // Missions
        document.getElementById('missionList').innerHTML = state.missions.map(m => `
            <div class="mission-row">
                <div style="font-size:12px;">${m.desc} (${m.prog}/${m.target})</div>
                ${m.claimed ? '<i class="fa-solid fa-check" style="color:var(--success)"></i>' : 
                  (m.prog >= m.target ? `<button class="btn btn-primary" style="padding:4px 8px; font-size:10px;" onclick="claimMission('${m.id}')">Claim</button>` : 
                  `<div style="font-size:10px; opacity:0.5">${Math.floor((m.prog/m.target)*100)}%</div>`)}
            </div>
        `).join('');
    }

    // --- UTILS ---
    function showToast(msg, type='info') {
        const t = document.createElement('div');
        t.className = `toast ${type}`;
        t.innerHTML = msg;
        document.getElementById('toastContainer').appendChild(t);
        setTimeout(() => { t.style.animation = 'toastOut 0.3s forwards'; setTimeout(()=>t.remove(),300); }, 2000);
    }

    function showAuthInput(type) {
        document.getElementById('authInputs').style.display='block';
        document.getElementById('authField').placeholder = type==='phone' ? "Enter Phone" : "Enter Email";
    }
    
    function fakeLogin(mode) {
        state.user.name = mode==='Guest' ? "Guest_"+Math.floor(Math.random()*999) : "User_Verified";
        state.user.uid = "local_"+Date.now();
        document.getElementById('loginPrompt').style.display='none';
        closeModal('authModal');
        showToast(`Welcome, ${state.user.name}`, "success");
        save(); renderAll();
    }

    function save() { localStorage.setItem('guessit_b13', JSON.stringify(state)); if(state.user.uid && db) db.collection('users').doc(state.user.uid).set(state).catch(()=>{}); }
    function applySettings() {
        if(state.settings.theme) document.body.setAttribute('data-theme', state.settings.theme);
        document.body.classList.toggle('dark-mode', state.settings.darkMode);
        document.getElementById('bgmSelect').value = state.settings.bgm;
    }
    function setAudioSource(val) {
        ['smooth','montagem','sigilo','sempero'].forEach(k=>document.getElementById('bgMusic_'+k).pause());
        const map = {'SMOOTH':'smooth','MONTAGEM':'montagem','SIGILO':'sigilo','SEMPERO':'sempero'};
        currentAudio = document.getElementById('bgMusic_'+map[val]);
        if(state.settings.music) currentAudio.play();
    }
    function changeBGM(v) { state.settings.bgm=v; setAudioSource(v); save(); }
    function toggleSetting(k) { state.settings[k]=!state.settings[k]; if(k==='music') state.settings.music ? currentAudio.play() : currentAudio.pause(); document.getElementById('st'+(k==='music'?'Music':'Sfx')).innerText=state.settings[k]?'ON':'OFF'; save(); }
    function toggleDarkMode() { state.settings.darkMode=!state.settings.darkMode; applySettings(); save(); }
    
    function nav(id, el) {
        document.querySelectorAll('.tab-view').forEach(t => { t.classList.remove('active'); t.style.opacity='0'; t.style.transform='translateY(5px)'; });
        const at = document.getElementById('tab-'+id); at.classList.add('active');
        setTimeout(() => { at.style.opacity='1'; at.style.transform='translateY(0)'; }, 10);
        document.querySelectorAll('.dock i').forEach(i=>i.classList.remove('active')); el.classList.add('active');
    }
    function openModal(id) { document.getElementById(id).classList.add('open'); if(id==='setupModal') updateAvatarPreview(); }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }
    
    function saveProfile() { state.user.name=document.getElementById('setupName').value||state.user.name; state.user.bio=document.getElementById('setupBio').value||state.user.bio; save(); renderAll(); closeModal('setupModal'); }
    function cycleAvatar(d) { state.user.avatarIdx=(state.user.avatarIdx+d+AVATARS.length)%AVATARS.length; updateAvatarPreview(); }
    
    function updateAvatarPreview() { 
        // Priority: Custom -> Predefined
        const u = state.user.avatarCustom ? state.user.avatarCustom : `https://api.dicebear.com/9.x/notionists/svg?seed=${AVATARS[state.user.avatarIdx]}`; 
        document.getElementById('setupAvatar').src=u; 
        document.getElementById('profileAvatar').src=u; 
    }
    
    function uploadAvatar(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                // Basic compression/limit check recommended in prod
                state.user.avatarCustom = e.target.result;
                updateAvatarPreview();
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    function eventCheckIn() { const t=new Date().toDateString(); if(state.event.checkedIn.includes(t)) return showToast("Already checked in!", "info"); state.event.checkedIn.push(t); state.wallet.eventCrystals+=15; addItem('xp_card',1); showToast("+15 Crystals, +1 XP Card", "success"); save(); renderAll(); }
    function checkEventValidity() { if(true) document.getElementById('eventCard').style.display='block'; }
  </script>
</body>
</html>


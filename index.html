<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#0f172a">
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <title>Guess It! V1.3.16</title>

  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    /* --- VARIABLES --- */
    :root {
      --bg: #f8fafc;
      --card: rgba(255, 255, 255, 0.9);
      --border: rgba(99, 102, 241, 0.15);
      --text: #0f172a;
      --text-muted: #64748b;
      --primary: #6366f1;
      --primary-glow: rgba(99, 102, 241, 0.3);
      --accent: #f43f5e;
      --gold: #f59e0b;
      --crystal: #8b5cf6;
      --font-head: 'Space Grotesk', sans-serif;
      --font-body: 'Outfit', sans-serif;
      --modal-bg: #ffffff;
      --input-bg: #f1f5f9;
      --dock-bg: rgba(255, 255, 255, 0.95);
    }

    /* DARK MODE */
    body.dark-mode {
      --bg: #030712;
      --card: rgba(30, 41, 59, 0.8);
      --border: rgba(99, 102, 241, 0.3);
      --text: #f8fafc;
      --text-muted: #94a3b8;
      --primary-glow: rgba(99, 102, 241, 0.5);
      --gold: #fbbf24;
      --modal-bg: #0f172a;
      --input-bg: rgba(255,255,255,0.05);
      --dock-bg: rgba(15, 23, 42, 0.95);
    }

    /* THEMES */
    body[data-theme="Gold"] { --bg: #fffbeb; --card: rgba(255, 251, 235, 0.95); --primary: #d97706; --border: #d97706; }
    body.dark-mode[data-theme="Gold"] { --bg: #1a1200; --card: rgba(40,30,10,0.95); --primary: #fbbf24; --border: #fbbf24; }
    body[data-theme="Matrix"] { --bg: #000; --card: rgba(0,20,0,0.9); --primary: #00ff41; --border: #008f11; --text: #e0f2fe; --font-head: 'Courier New', monospace; }
    body.dark-mode[data-theme="Matrix"] { --bg: #000; --text: #00ff41; }

    /* --- BASE --- */
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: var(--font-body); user-select: none; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; font-size: 14px; position: relative; transition: background 0.4s ease, color 0.4s ease; }

    /* --- ANIMATIONS --- */
    .bg-fx { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle at 50% 0%, var(--primary-glow) 0%, transparent 70%); opacity: 0.6; pointer-events: none; }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    
    /* --- LAYOUT --- */
    .app { max-width: 480px; margin: 0 auto; height: 100%; display: flex; flex-direction: column; opacity: 0; transition: opacity 0.6s ease-out; }
    .app.loaded { opacity: 1; }
    .content { flex: 1; overflow-y: auto; padding: 20px 20px 110px 20px; scroll-behavior: smooth; }
    .content::-webkit-scrollbar { display: none; }

    /* --- UI ELEMENTS --- */
    .card { 
        background: var(--card); border: 1px solid var(--border); 
        border-radius: 24px; padding: 20px; margin-bottom: 15px; 
        backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.03); 
    }
    
    .btn { 
        background: var(--input-bg); color: var(--text); border: 1px solid var(--border); 
        padding: 14px; border-radius: 16px; font-weight: 700; cursor: pointer; width: 100%; 
        display: flex; align-items: center; justify-content: center; gap: 8px; 
        font-family: var(--font-head); font-size: 13px; text-transform: uppercase; 
        transition: 0.2s; position: relative; overflow: hidden;
    }
    .btn:active { transform: scale(0.96); }
    .btn-primary { background: var(--primary); border: none; color: white; box-shadow: 0 4px 15px var(--primary-glow); }
    
    /* --- AVATAR & FRAMES --- */
    .avatar-wrap { position: relative; display: inline-block; margin-bottom: 10px; width: 84px; height: 84px; }
    .avatar-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); }
    .avatar-frame { 
        position: absolute; top: -5%; left: -5%; width: 110%; height: 110%; 
        border-radius: 50%; pointer-events: none; z-index: 5; display: none;
    }
    .frame-neon { display: block; border: 3px solid #0ff; box-shadow: 0 0 15px #0ff, inset 0 0 10px #0ff; }
    .frame-gold { display: block; border: 4px solid #ffd700; box-shadow: 0 0 20px #ffd700; }
    
    .badge-display {
        display: inline-flex; align-items: center; justify-content: center;
        width: 20px; height: 20px; border-radius: 50%; background: var(--bg);
        border: 1px solid var(--border); font-size: 10px; color: var(--gold);
        margin-left: 5px; vertical-align: middle; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* --- SPINNER WHEEL --- */
    .wheel-wrapper { width: 220px; height: 220px; margin: 10px auto; border-radius: 50%; border: 4px solid var(--card); box-shadow: 0 0 20px rgba(0,0,0,0.1); position: relative; overflow: hidden; transform: translateZ(0); }
    .wheel { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(var(--accent) 0deg 60deg, var(--primary) 60deg 120deg, var(--gold) 120deg 180deg, #10b981 180deg 240deg, #a855f7 240deg 300deg, #3b82f6 300deg 360deg); transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1); }
    .wheel-arrow { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 20px solid var(--text); z-index: 10; }

    /* --- SPLASH CUBE --- */
    .splash { position: fixed; inset: 0; z-index: 9999; background: #020617; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.6s ease-in-out; }
    .cube-wrap { perspective: 800px; width: 60px; height: 60px; margin-bottom: 30px; }
    .cube { width: 100%; height: 100%; transform-style: preserve-3d; animation: spin 6s infinite linear; }
    .face { position: absolute; width: 60px; height: 60px; background: rgba(99,102,241,0.1); border: 2px solid var(--primary); display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; box-shadow: 0 0 20px var(--primary-glow); font-weight: 900; }
    .f1 { transform: translateZ(30px); } .f2 { transform: rotateY(180deg) translateZ(30px); }
    .f3 { transform: rotateY(90deg) translateZ(30px); } .f4 { transform: rotateY(-90deg) translateZ(30px); }
    .f5 { transform: rotateX(90deg) translateZ(30px); } .f6 { transform: rotateX(-90deg) translateZ(30px); }
    @keyframes spin { 0% { transform: rotateX(0) rotateY(0); } 100% { transform: rotateX(360deg) rotateY(360deg); } }

    /* --- MODALS & DOCK --- */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.3s; }
    .overlay.open { opacity: 1; pointer-events: auto; }
    .modal { background: var(--modal-bg); width: 90%; max-width: 380px; padding: 25px; border-radius: 28px; border: 1px solid var(--border); text-align: center; transform: scale(0.9); transition: 0.3s; max-height: 85vh; overflow-y: auto; color: var(--text); position: relative; z-index: 2005; }
    .overlay.open .modal { transform: scale(1); }

    .dock-container { position: fixed; bottom: 20px; left: 0; width: 100%; display: flex; justify-content: center; z-index: 100; pointer-events: none; }
    .dock { background: var(--dock-bg); backdrop-filter: blur(20px); padding: 12px 25px; border-radius: 24px; display: flex; gap: 40px; border: 1px solid var(--border); pointer-events: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
    .dock i { font-size: 22px; color: var(--text-muted); transition: 0.3s; cursor: pointer; }
    .dock i.active { color: var(--primary); transform: translateY(-5px); }

    /* UTILS */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .tab-view { display: none; opacity: 0; transform: translateY(10px); transition: 0.3s; }
    .tab-view.active { display: block; opacity: 1; transform: translateY(0); }
    .item-box { background: var(--input-bg); border: 1px solid var(--border); padding: 12px; border-radius: 16px; text-align: center; cursor: pointer; position: relative; }
    .item-tag { position: absolute; top: -5px; right: -5px; padding: 2px 6px; border-radius: 8px; font-size: 9px; font-weight: bold; color: white; background: var(--text-muted); }
    .tag-equipped { background: var(--primary); }
    .currency-pill { background: var(--input-bg); border: 1px solid var(--border); padding: 5px 12px; border-radius: 20px; font-size: 11px; display: flex; align-items: center; gap: 6px; font-weight: bold; cursor: pointer; }
    .custom-input { width: 100%; background: var(--input-bg); border: 1px solid var(--border); padding: 14px; border-radius: 14px; color: var(--text); outline: none; margin-top: 5px; }
    
    /* CALENDAR */
    .cal-day { padding:10px; border:1px solid var(--border); border-radius:8px; background:var(--input-bg); font-size:12px; }
    .cal-day.active { border-color:var(--primary); background:var(--primary-glow); }
    .cal-day.claimed { opacity:0.5; }

    /* TOAST */
    #toastContainer { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 99999; width: 90%; max-width: 350px; pointer-events: none; display: flex; flex-direction: column; gap: 8px; }
    .toast { background: var(--modal-bg); border: 1px solid var(--border); padding: 12px 16px; border-radius: 12px; font-weight: 600; font-size: 13px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); animation: toastIn 0.3s; display: flex; align-items: center; gap: 10px; }
    .toast.success { border-left: 4px solid #10b981; } .toast.error { border-left: 4px solid #ef4444; }
    @keyframes toastIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>
  
  <div id="toastContainer"></div>
  <div class="bg-fx"></div>

  <audio id="bgMusic_smooth" loop preload="auto"><source src="no-copyright-gaming-background-music-for-minecraftgaming-405002.mp3" type="audio/mpeg"></audio>
  <audio id="bgMusic_montagem" loop preload="auto"><source src="MONTAGEM XONADA.mp3" type="audio/mpeg"></audio>
  <audio id="bgMusic_sigilo" loop preload="auto"><source src="FUNK SIGILO SLOWED.mp3" type="audio/mpeg"></audio>
  <audio id="bgMusic_sempero" loop preload="auto"><source src="SEMPERO_Slowed_KLICKAUD.mp3" type="audio/mpeg"></audio>

  <div class="splash" id="splash">
    <div class="cube-wrap"><div class="cube"><div class="face f1">G</div><div class="face f2">?</div><div class="face f3">!</div><div class="face f4">#</div><div class="face f5"></div><div class="face f6"></div></div></div>
    <h1 style="color:white; letter-spacing:4px; font-weight:800; font-size:32px;">GUESSIT!</h1>
    <div style="color:rgba(255,255,255,0.5); font-size:12px; margin-top:5px;">V1.3.16</div>
  </div>

  <div class="app" id="app">
    
    <div style="padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
        <div style="font-family: var(--font-head); font-weight: 800; font-size: 18px; display: flex; align-items: center; gap: 10px;">
            <i class="fa-solid fa-cube" style="color:var(--primary)"></i> GUESSIT!
        </div>
        <div style="display:flex; gap:6px;">
            <div class="currency-pill" onclick="openModal('currencyModal')"><i class="fa-solid fa-circle-info" style="color:var(--text-muted)"></i></div>
            <div class="currency-pill"><i class="fa-solid fa-coins" style="color:var(--gold)"></i> <span id="uiCoins">0</span></div>
            <div class="currency-pill"><i class="fa-regular fa-gem" style="color:#38bdf8"></i> <span id="uiGems">0</span></div>
            <div class="currency-pill"><i class="fa-solid fa-bolt" style="color:var(--crystal)"></i> <span id="uiCrystals">0</span></div>
        </div>
    </div>

    <div class="content">
        <div id="tab-home" class="tab-view active">
            <div id="eventCard" class="card" style="background: linear-gradient(135deg, #4f46e5, #9333ea); color:white; border:none;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-size:10px; background:rgba(255,255,255,0.2); width:fit-content; padding:2px 6px; border-radius:4px; margin-bottom:5px;">LIVE EVENT</div>
                        <h3>Crystal Hunt</h3>
                        <div style="font-size:11px; opacity:0.9;">Earn Crystals in Hardcore Mode!</div>
                    </div>
                    <i class="fa-solid fa-gem" style="font-size:32px; opacity:0.5;"></i>
                </div>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button class="btn" style="padding:8px; font-size:11px; width:auto; border:none; background:rgba(255,255,255,0.2); color:white;" onclick="eventCheckIn()">Check In</button>
                    <button class="btn" style="padding:8px; font-size:11px; width:auto; border:none; background:white; color:var(--primary);" onclick="startGame('hardcore')">Play Hardcore</button>
                </div>
            </div>

            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                   <div>
                       <span style="font-size:12px; color:var(--text-muted);">Current Rank</span>
                       <div style="font-weight:800; font-size:16px;" id="homeRankDisplay">Novice</div>
                   </div> 
                   <button class="btn btn-primary" style="width:auto; padding:8px 20px;" onclick="startGame('classic')">
                       <i class="fa-solid fa-play"></i> PLAY
                   </button>
                </div>
                <div style="font-size:10px; color:var(--text-muted); display:flex; justify-content:space-between;">
                    <span>Level <span id="homeLvl">1</span></span>
                    <span id="homeXp">0/100 XP</span>
                </div>
                <div style="width:100%; height:6px; background:rgba(0,0,0,0.1); border-radius:10px; margin-top:5px;">
                    <div id="homeXpBar" style="height:100%; background:var(--primary); width:0%; border-radius:10px; transition:width 0.5s;"></div>
                </div>
            </div>

            <div class="card" style="padding:0; overflow:hidden;">
                <div style="padding:15px; border-bottom:1px solid var(--border); font-weight:bold; font-size:12px;">DAILY MISSIONS</div>
                <div id="missionList"></div>
            </div>
        </div>

        <div id="tab-shop" class="tab-view">
            <h2 style="margin-bottom:15px;">Marketplace</h2>
            <div class="grid-2" style="margin-bottom:15px;">
                <button class="btn" onclick="checkCalendar()"><i class="fa-solid fa-calendar-check" style="color:var(--gold)"></i> Calendar</button>
                <button class="btn" onclick="openModal('spinnerModal')"><i class="fa-solid fa-dharmachakra" style="color:var(--accent)"></i> Spinner</button>
            </div>
            
            <div class="card" style="background:linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(0,0,0,0)); border-color:var(--crystal);">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <h3 style="color:var(--crystal)">Redeem Crystals</h3>
                    <div style="font-size:11px;">Bal: <span id="shopCrystalBal">0</span></div>
                </div>
                <div class="grid-3" id="shopRedeem"></div>
            </div>

            <h4 style="margin:15px 0 10px; color:var(--text-muted); font-size:12px;">BOOSTS & ITEMS</h4>
            <div class="grid-2" id="shopConsumables"></div>
            <h4 style="margin:15px 0 10px; color:var(--text-muted); font-size:12px;">COSMETICS (COINS)</h4>
            <div class="grid-2" id="shopCosmetics"></div>
        </div>

        <div id="tab-profile" class="tab-view">
            <div class="card" style="text-align:center;">
                <div style="position:absolute; top:15px; right:15px; cursor:pointer;" onclick="openModal('settingsModal')"><i class="fa-solid fa-gear"></i></div>
                <div class="avatar-wrap">
                    <img id="profileAvatar" src="" class="avatar-img">
                    <div id="profileFrame" class="avatar-frame"></div>
                </div>
                <h2 style="display:flex; align-items:center; justify-content:center; gap:5px;">
                    <span id="profileName">Guest</span>
                    <span id="profileBadge" class="badge-display" style="display:none;"></span>
                </h2>
                <div id="profileBio" style="font-size:12px; color:var(--text-muted); margin-bottom:15px;">...</div>
                <div class="card" style="margin-bottom:10px; padding:15px;">
                    <div style="display:flex; justify-content:space-between; font-size:12px; color:var(--text-muted);">
                        <span>Level <span id="rankLvl">1</span></span>
                        <span id="rankName">Novice</span>
                    </div>
                </div>
                <div id="loginPrompt" style="margin-top:20px;">
                    <button class="btn btn-primary" onclick="openModal('authModal')">Login / Signup</button>
                </div>
                <div class="grid-2" style="margin-top:10px;">
                    <button class="btn" onclick="openModal('setupModal')">Edit Profile</button>
                    <button class="btn" onclick="openModal('inventoryModal')">Inventory</button>
                </div>
            </div>
        </div>
    </div>

    <div class="dock-container">
        <div class="dock">
            <i class="fa-solid fa-house active" onclick="nav('home', this)"></i>
            <i class="fa-solid fa-store" onclick="nav('shop', this)"></i>
            <i class="fa-solid fa-user" onclick="nav('profile', this)"></i>
        </div>
    </div>
  </div>

  <div class="overlay" id="settingsModal">
      <div class="modal">
          <h3>Settings</h3>
          <div style="text-align:left; margin:20px 0; display:flex; flex-direction:column; gap:10px;">
             <div style="font-size:12px; color:var(--text-muted);">Audio Track</div>
             <select class="custom-input" id="bgmSelect" onchange="changeBGM(this.value)">
                 <option value="SMOOTH">Smooth</option>
                 <option value="MONTAGEM">Montagem</option>
                 <option value="SIGILO">Sigilo</option>
                 <option value="SEMPERO">Sempero</option>
             </select>
             <button class="btn" onclick="toggleSetting('music')">Music: <span id="stMusic">OFF</span></button>
             <button class="btn" onclick="toggleSetting('sfx')">SFX: <span id="stSfx">ON</span></button>
             <button class="btn" onclick="toggleDarkMode()">Toggle Dark Mode</button>
             <button class="btn" style="border:1px solid #ef4444; color:#ef4444;" onclick="firebase.auth().signOut(); window.location.reload();">Log Out</button>
          </div>
          <button class="btn" onclick="closeModal('settingsModal')">Close</button>
      </div>
  </div>

  <div class="overlay" id="authModal">
      <div class="modal">
          <h3>Account Access</h3>
          <div id="authMain" style="display:flex; flex-direction:column; gap:10px; margin-top:20px;">
              <button class="btn" onclick="showEmailAuth()"><i class="fa-solid fa-envelope"></i> Continue with Email</button>
              <button class="btn" style="background:#fff; color:#000; border:1px solid #ddd;" onclick="googleLogin()"><i class="fa-brands fa-google"></i> Google</button>
              <button class="btn" onclick="fakeLogin()">Guest Login</button>
          </div>
          <div id="authEmailForm" style="display:none; margin-top:15px;">
              <input type="email" id="emailInput" class="custom-input" placeholder="Email Address">
              <input type="password" id="passInput" class="custom-input" placeholder="Password">
              <div class="grid-2" style="margin-top:10px;">
                  <button class="btn btn-primary" onclick="emailAuth('login')">Login</button>
                  <button class="btn" onclick="emailAuth('signup')">Sign Up</button>
              </div>
              <div style="margin-top:10px; font-size:11px; cursor:pointer; color:var(--text-muted);" onclick="hideEmailAuth()">Back to Options</div>
          </div>
          <button class="btn" style="margin-top:15px; border:none;" onclick="closeModal('authModal')">Close</button>
      </div>
  </div>

  <div class="overlay" id="inventoryModal">
      <div class="modal">
          <h3>Inventory</h3>
          <div style="font-size:11px; margin-bottom:10px; color:var(--crystal); font-weight:bold;">Crystals: <span id="invCrystalBal">0</span> <i class="fa-solid fa-bolt"></i></div>
          <h5 style="text-align:left; margin-top:15px; color:var(--text-muted);">Frames & Badges</h5>
          <div class="grid-3" id="invEquip" style="margin-top:5px;"></div>
          <h5 style="text-align:left; margin-top:15px; color:var(--text-muted);">Consumables & Themes</h5>
          <div class="grid-2" id="invItems" style="margin-top:5px;"></div>
          <button class="btn" style="margin-top:20px;" onclick="closeModal('inventoryModal')">Close</button>
      </div>
  </div>

  <div class="overlay" id="currencyModal">
      <div class="modal">
          <h3>Currency Guide</h3>
          <div style="text-align:left; font-size:13px; margin-top:15px; display:flex; flex-direction:column; gap:15px;">
              <div style="display:flex; gap:10px; align-items:center;"><i class="fa-solid fa-coins" style="color:var(--gold);"></i> Coins: Earn by playing.</div>
              <div style="display:flex; gap:10px; align-items:center;"><i class="fa-regular fa-gem" style="color:#38bdf8;"></i> Gems: Premium currency.</div>
              <div style="display:flex; gap:10px; align-items:center;"><i class="fa-solid fa-bolt" style="color:var(--crystal);"></i> Crystals: Event exclusive.</div>
          </div>
          <button class="btn btn-primary" style="margin-top:20px;" onclick="closeModal('currencyModal')">Got it!</button>
      </div>
  </div>

  <div class="overlay" id="spinnerModal">
      <div class="modal">
          <h3>Lucky Spin</h3>
          <div class="wheel-wrapper"><div class="wheel-arrow"></div><div class="wheel" id="theWheel"></div></div>
          <button class="btn btn-primary" id="spinBtn" style="margin-top:20px;" onclick="spinWheel()">SPIN NOW</button>
          <button class="btn" style="margin-top:10px; border:none;" onclick="closeModal('spinnerModal')">Close</button>
      </div>
  </div>

  <div class="overlay" id="calendarModal">
      <div class="modal">
          <h3>Daily Login</h3>
          <div class="grid-3" id="calGrid" style="margin-top:15px;"></div>
          <button class="btn btn-primary" id="claimCalBtn" style="margin-top:15px;" onclick="claimDaily()">Claim Reward</button>
          <button class="btn" style="margin-top:10px; border:none;" onclick="closeModal('calendarModal')">Close</button>
      </div>
  </div>

  <div class="overlay" id="gameModal">
      <div class="modal">
          <div style="display:flex; justify-content:space-between; align-items:center;">
              <span id="gameModeBadge" style="font-size:10px; background:var(--accent); color:white; padding:2px 6px; border-radius:4px;">HARDCORE</span>
              <div id="gameTimer" style="font-weight:bold; color:var(--accent);"></div>
              <i class="fa-solid fa-xmark" onclick="closeModal('gameModal')" style="cursor:pointer; padding:5px;"></i>
          </div>
          <div style="width:160px; height:160px; background:white; border-radius:30px; margin:15px auto; padding:20px; display:flex; align-items:center; justify-content:center;">
              <img id="gameImg" style="width:100%; height:100%; object-fit:contain;">
          </div>
          <input type="text" id="gInput" class="custom-input" style="text-align:center; font-size:20px; text-transform:uppercase; letter-spacing:2px; margin-bottom:15px;" placeholder="LOGO NAME">
          <button class="btn btn-primary" onclick="submitGuess()">Submit Answer</button>
      </div>
  </div>
  
  <div class="overlay" id="setupModal"><div class="modal"><h3>Setup</h3><input id="setupName" class="custom-input" placeholder="New Username"><button class="btn btn-primary" style="margin-top:15px;" onclick="saveProfile()">Save Profile</button><button class="btn" style="margin-top:10px;" onclick="closeModal('setupModal')">Cancel</button></div></div>

  <script>
    // --- CONFIG ---
    const firebaseConfig = { apiKey: "AIzaSyAbKxS6HUPn1c632CMPzvLQiJBw57vqflQ", authDomain: "studio-4144954497-c3ea9.firebaseapp.com", projectId: "studio-4144954497-c3ea9" };
    
    // DATA
    const SHOP_ITEMS = [
        { id:'xp_card', n:'2x XP', type:'consumable', cost:50, currency:'coins', icon:'fa-bolt' },
        { id:'frame_neon', n:'Neon Frame', type:'frame', cost:50, currency:'crystals', cssClass:'frame-neon' },
        { id:'frame_gold', n:'Gold Halo', type:'frame', cost:100, currency:'crystals', cssClass:'frame-gold' },
        { id:'badge_pro', n:'Pro Badge', type:'badge', cost:30, currency:'crystals', icon:'fa-star' },
        { id:'th_gold', n:'Gold Theme', type:'theme', cost:500, currency:'coins', val:'Gold' },
        { id:'th_matrix', n:'Matrix Theme', type:'theme', cost:500, currency:'coins', val:'Matrix' }
    ];
    const CAL_REWARDS = [ {t:'coins',v:50},{t:'coins',v:100},{t:'gems',v:10},{t:'coins',v:200},{t:'gems',v:25},{t:'coins',v:500},{t:'crystals',v:10} ];
    const LOGOS = [{n:'Apple',d:'apple.com'},{n:'Google',d:'google.com'},{n:'Tesla',d:'tesla.com'},{n:'Nike',d:'nike.com'}];

    // --- STATE ---
    let state = {
        user: { name: 'Guest', uid: null, equippedFrame: null, equippedBadge: null, avatarIdx: 0 },
        wallet: { coins: 100, gems: 10, eventCrystals: 50 },
        stats: { lvl: 1, xp: 0, wins: 0 },
        inventory: {},
        settings: { theme: '', darkMode: false, music: false, sfx: true, bgm: 'SMOOTH' },
        daily: { lastLogin: 0, streak: 0, lastSpin: 0 },
        missions: [
            {id:'win3', desc:'Win 3 Games', target:3, prog:0, claimed:false, rwd:50},
            {id:'play5', desc:'Play 5 Games', target:5, prog:0, claimed:false, rwd:50}
        ]
    };
    let db, currentGame, currentAudio;
    let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // --- INIT ---
    window.onload = () => {
        setTimeout(() => { document.getElementById('splash').style.opacity = 0; document.getElementById('splash').style.pointerEvents = 'none'; document.getElementById('app').classList.add('loaded'); }, 1500);
        try { firebase.initializeApp(firebaseConfig); db = firebase.firestore(); firebase.auth().onAuthStateChanged(u => { if(u) { state.user.uid = u.uid; loadCloud(u.uid); document.getElementById('loginPrompt').style.display='none'; } }); } catch(e) {}
        loadLocal(); applyVisuals(); renderAll(); updateAudioState();
    };

    // --- AUDIO ---
    function updateAudioState() {
        ['smooth','montagem','sigilo','sempero'].forEach(k=>document.getElementById('bgMusic_'+k).pause());
        const map = {'SMOOTH':'smooth','MONTAGEM':'montagem','SIGILO':'sigilo','SEMPERO':'sempero'};
        currentAudio = document.getElementById('bgMusic_'+map[state.settings.bgm]);
        if(state.settings.music) { audioCtx.resume(); currentAudio.play().catch(()=>{}); }
        document.getElementById('stMusic').innerText = state.settings.music ? 'ON' : 'OFF';
        document.getElementById('stSfx').innerText = state.settings.sfx ? 'ON' : 'OFF';
        document.getElementById('bgmSelect').value = state.settings.bgm;
    }
    function toggleSetting(k) { state.settings[k]=!state.settings[k]; updateAudioState(); save(); }
    function changeBGM(v) { state.settings.bgm=v; updateAudioState(); save(); }

    // --- AUTH ---
    function showEmailAuth() { document.getElementById('authMain').style.display='none'; document.getElementById('authEmailForm').style.display='block'; }
    function hideEmailAuth() { document.getElementById('authMain').style.display='flex'; document.getElementById('authEmailForm').style.display='none'; }
    function emailAuth(mode) {
        const e = document.getElementById('emailInput').value, p = document.getElementById('passInput').value;
        if(!e||!p) return showToast("Enter details", "error");
        (mode==='signup' ? firebase.auth().createUserWithEmailAndPassword(e,p) : firebase.auth().signInWithEmailAndPassword(e,p))
        .then(() => { showToast("Success!", "success"); closeModal('authModal'); }).catch(err => showToast(err.message, "error"));
    }
    function googleLogin() { const p = new firebase.auth.GoogleAuthProvider(); firebase.auth().signInWithPopup(p).then(()=>closeModal('authModal')).catch(e=>showToast(e.message,"error")); }
    function fakeLogin() { state.user.name = "Guest Player"; closeModal('authModal'); renderAll(); }

    // --- LOGIC ---
    function startGame(mode) {
        currentGame = LOGOS[Math.floor(Math.random() * LOGOS.length)];
        document.getElementById('gameImg').src = `https://logo.clearbit.com/${currentGame.d}`;
        document.getElementById('gInput').value = '';
        document.getElementById('gameModeBadge').style.display = mode === 'hardcore' ? 'block' : 'none';
        openModal('gameModal');
    }
    function submitGuess() {
        if(document.getElementById('gInput').value.trim().toLowerCase() === currentGame.n.toLowerCase()) {
            closeModal('gameModal');
            const isHard = document.getElementById('gameModeBadge').style.display !== 'none';
            state.wallet.coins += isHard ? 40 : 20; if(isHard) state.wallet.eventCrystals += 5;
            state.stats.xp += isHard ? 100 : 50; state.stats.wins++;
            state.missions.forEach(m => { if(m.prog < m.target) m.prog++; }); // Update Missions
            showToast("Correct!", "success"); save(); renderAll();
        } else showToast("Try again", "error");
    }

    // --- MISSIONS & REWARDS ---
    function claimMission(id) {
        const m = state.missions.find(x => x.id === id);
        if(m && m.prog >= m.target && !m.claimed) {
            m.claimed = true; state.wallet.coins += m.rwd;
            showToast(`Claimed ${m.rwd} Coins`, "success"); save(); renderAll();
        }
    }
    function checkCalendar() {
        const dDiff = Math.floor((Date.now() - state.daily.lastLogin)/(86400000));
        if(dDiff > 1) state.daily.streak = 0;
        const grid = document.getElementById('calGrid'); grid.innerHTML = '';
        for(let i=0; i<7; i++) {
            let cls = i < state.daily.streak ? 'claimed' : i === state.daily.streak ? 'active' : '';
            grid.innerHTML += `<div class="cal-day ${cls}">Day ${i+1}<br>${CAL_REWARDS[i].v}</div>`;
        }
        document.getElementById('claimCalBtn').disabled = dDiff < 1 && state.daily.lastLogin !== 0;
        openModal('calendarModal');
    }
    function claimDaily() {
        const day = state.daily.streak % 7; const r = CAL_REWARDS[day];
        state.wallet[r.t] += r.v; state.daily.streak++; state.daily.lastLogin = Date.now();
        showToast("Reward Claimed!", "success"); closeModal('calendarModal'); save(); renderAll();
    }
    function spinWheel() {
        const wheel = document.getElementById('theWheel');
        wheel.style.transform = `rotate(${1800 + Math.random()*360}deg)`;
        setTimeout(() => { state.wallet.coins += 50; showToast("Won 50 Coins!", "success"); closeModal('spinnerModal'); save(); renderAll(); }, 4000);
    }

    // --- UI & SHOP ---
    function applyVisuals() {
        if(state.settings.theme) document.body.setAttribute('data-theme', state.settings.theme); else document.body.removeAttribute('data-theme');
        document.body.classList.toggle('dark-mode', state.settings.darkMode);
        document.getElementById('profileFrame').className = 'avatar-frame ' + (state.user.equippedFrame ? SHOP_ITEMS.find(i=>i.id===state.user.equippedFrame).cssClass : '');
        document.getElementById('profileFrame').style.display = state.user.equippedFrame ? 'block' : 'none';
        document.getElementById('profileBadge').innerHTML = state.user.equippedBadge ? `<i class="fa-solid ${SHOP_ITEMS.find(i=>i.id===state.user.equippedBadge).icon}"></i>` : '';
        document.getElementById('profileBadge').style.display = state.user.equippedBadge ? 'inline-flex' : 'none';
        document.getElementById('profileAvatar').src = `https://api.dicebear.com/9.x/notionists/svg?seed=${state.user.avatarIdx}`;
    }
    function buyItem(id) {
        const i = SHOP_ITEMS.find(x => x.id === id);
        let c = i.currency === 'coins' ? 'coins' : i.currency === 'gems' ? 'gems' : 'eventCrystals';
        if(state.wallet[c] >= i.cost) { state.wallet[c] -= i.cost; state.inventory[id] = (state.inventory[id]||0)+1; showToast("Purchased!", "success"); save(); renderAll(); } else showToast("Insufficient funds", "error");
    }
    function equipItem(id, type) {
        if(type === 'frame') state.user.equippedFrame = state.user.equippedFrame === id ? null : id;
        if(type === 'badge') state.user.equippedBadge = state.user.equippedBadge === id ? null : id;
        if(type === 'theme') state.settings.theme = state.settings.theme === SHOP_ITEMS.find(x=>x.id===id).val ? '' : SHOP_ITEMS.find(x=>x.id===id).val;
        save(); renderAll();
    }
    function saveProfile() { 
        const n = document.getElementById('setupName').value; 
        if(n.trim()) state.user.name = n; 
        closeModal('setupModal'); save(); renderAll(); 
    }

    // --- RENDER ---
    function renderAll() {
        applyVisuals();
        ['uiCoins','uiGems','uiCrystals'].forEach(k => document.getElementById(k).innerText = state.wallet[k==='uiCoins'?'coins':k==='uiGems'?'gems':'eventCrystals']);
        document.getElementById('profileName').innerText = state.user.name;
        document.getElementById('rankLvl').innerText = state.stats.lvl;
        document.getElementById('homeLvl').innerText = state.stats.lvl;
        document.getElementById('homeXp').innerText = `${state.stats.xp}/${state.stats.lvl*100} XP`;
        document.getElementById('homeXpBar').style.width = Math.min((state.stats.xp/(state.stats.lvl*100))*100, 100) + '%';
        
        // Missions
        document.getElementById('missionList').innerHTML = state.missions.map(m => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid var(--border);">
                <div style="font-size:12px;">${m.desc} (${m.prog}/${m.target})</div>
                ${m.claimed ? '<i class="fa-solid fa-check" style="color:#10b981"></i>' : (m.prog>=m.target ? `<button class="btn btn-primary" style="padding:2px 8px; font-size:10px; width:auto;" onclick="claimMission('${m.id}')">Claim</button>` : `<div style="font-size:10px; opacity:0.5;">${Math.round((m.prog/m.target)*100)}%</div>`)}
            </div>`).join('');
            
        // Shop & Inv
        const [rEl, cEl, oEl, iEq, iIt] = ['shopRedeem','shopConsumables','shopCosmetics','invEquip','invItems'].map(id=>document.getElementById(id));
        [rEl, cEl, oEl, iEq, iIt].forEach(e => e.innerHTML = '');
        document.getElementById('invCrystalBal').innerText = state.wallet.eventCrystals;

        SHOP_ITEMS.forEach(i => {
            const btn = `<div class="item-box" onclick="buyItem('${i.id}')"><i class="fa-solid ${i.icon||'fa-gift'}" style="font-size:20px;"></i><div style="font-size:11px; font-weight:bold;">${i.n}</div><div style="font-size:10px;">${i.cost} ${i.currency==='crystals'?'<i class="fa-solid fa-bolt"></i>':i.currency==='gems'?'G':'C'}</div></div>`;
            if(i.currency === 'crystals') rEl.innerHTML+=btn; else if(i.type==='consumable') cEl.innerHTML+=btn; else oEl.innerHTML+=btn;
        });

        Object.keys(state.inventory).forEach(k => {
            if(state.inventory[k] > 0) {
                const i = SHOP_ITEMS.find(x=>x.id===k);
                if(i) {
                    const isEq = (state.user.equippedFrame===k || state.user.equippedBadge===k || state.settings.theme===i.val);
                    const html = `<div class="item-box" onclick="equipItem('${k}','${i.type}')">${isEq?'<div class="item-tag tag-equipped">ON</div>':''}<i class="fa-solid ${i.icon||'fa-star'}"></i><br><div style="font-size:11px;">${i.n}</div></div>`;
                    if(i.type==='frame'||i.type==='badge') iEq.innerHTML+=html; else iIt.innerHTML+=html;
                }
            }
        });
    }

    // --- UTILS ---
    function showToast(msg, type) { const t=document.createElement('div'); t.className=`toast ${type}`; t.innerHTML=msg; document.getElementById('toastContainer').appendChild(t); setTimeout(()=>t.remove(),2500); }
    function save() { localStorage.setItem('guessit_v16', JSON.stringify(state)); if(state.user.uid && db) db.collection('users').doc(state.user.uid).set(state); }
    function loadLocal() { const s=localStorage.getItem('guessit_v16'); if(s) state={...state, ...JSON.parse(s)}; }
    function loadCloud(uid) { db.collection('users').doc(uid).get().then(d => { if(d.exists) { state={...state, ...d.data()}; renderAll(); updateAudioState(); } }); }
    function nav(id, el) { document.querySelectorAll('.tab-view').forEach(t=>t.classList.remove('active')); document.getElementById('tab-'+id).classList.add('active'); document.querySelectorAll('.dock i').forEach(i=>i.classList.remove('active')); el.classList.add('active'); }
    function openModal(id) { document.getElementById(id).classList.add('open'); if(id==='setupModal') document.getElementById('setupName').value = state.user.name; }
    function closeModal(id) { document.getElementById(id).classList.remove('open'); }
    function toggleDarkMode() { state.settings.darkMode = !state.settings.darkMode; save(); renderAll(); }
    function eventCheckIn() { state.wallet.eventCrystals += 5; showToast("+5 Crystals", "success"); save(); renderAll(); }
  </script>
</body>
</html>

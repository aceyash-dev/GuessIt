<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <meta name="theme-color" content="#0f172a">
  <title>GuessIt! v1.31.08F</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700;900&family=Fredoka:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    /* --- VARIABLES --- */
    :root {
      --bg: #f8fafc; --bg-card: #ffffff; --text: #0f172a; --text-sub: #64748b;
      --accent: #fbbf24; --accent-fg: #000;
      --border: #e2e8f0; --radius: 24px; --font: 'Outfit', sans-serif;
      --shadow: 0 4px 12px rgba(0,0,0,0.05);
      --dock-bg: rgba(255,255,255,0.9);
      --success: #22c55e; --danger: #ef4444;
    }

    /* --- DARK MODE --- */
    body.force-dark {
      --bg: #020617 !important; --bg-card: #1e293b !important; --text: #f8fafc !important; --text-sub: #94a3b8 !important;
      --border: #334155 !important; --dock-bg: rgba(15, 23, 42, 0.9) !important;
    }

    /* --- ANIMATIONS --- */
    @keyframes chromaShift {
        0% { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.4); }
        50% { border-color: #ec4899; box-shadow: 0 0 15px rgba(236, 72, 153, 0.4); }
        100% { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.4); }
    }
    @keyframes bgShift { 0% {background-position:0% 50%} 50% {background-position:100% 50%} 100% {background-position:0% 50%} }
    @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }
    @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.05)} 100%{transform:scale(1)} }

    /* --- CORE --- */
    *{box-sizing:border-box;margin:0;padding:0;font-family:var(--font);-webkit-tap-highlight-color:transparent;user-select:none;}
    html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);transition:background 0.3s, color 0.3s;}
    
    .app-container { max-width: 480px; margin: 0 auto; height: 100%; display: flex; flex-direction: column; position: relative; opacity: 0; transition: opacity 0.5s ease; }
    .app-container.visible { opacity: 1; }
    
    /* --- COMPONENTS --- */
    .card { background: var(--bg-card); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); margin-bottom: 16px; border: 1px solid transparent; position: relative; overflow: hidden; animation: slideUp 0.3s ease-out; }
    .hero-card { background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(168,85,247,0.05)); border: 1px solid rgba(99,102,241,0.2); }
    
    .btn { background: var(--accent); color: var(--accent-fg); border: none; padding: 12px 20px; border-radius: 16px; font-weight: 800; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: 0.1s; width: 100%; font-size: 14px; }
    .btn:active { transform: scale(0.95); }
    .btn-ghost { background: transparent; color: var(--text); border: 1px solid var(--border); }
    .btn-primary { background: #4f46e5; color: white; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3); }
    .btn-sm { padding: 8px 16px; font-size: 13px; width: auto; border-radius: 12px; }

    .currency { background: rgba(0,0,0,0.05); padding: 6px 14px; border-radius: 20px; font-weight: 800; font-size: 13px; display: flex; align-items: center; gap: 6px; border: 1px solid var(--border); }
    
    .logo-box { width: 40px; height: 40px; background: var(--accent); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-family: 'Fredoka', sans-serif; font-weight: 900; font-size: 24px; color: var(--accent-fg); box-shadow: 0 4px 0 rgba(0,0,0,0.2); transform: rotate(-5deg); }
    .header-brand { display: flex; align-items: center; gap: 10px; font-family: 'Space Grotesk'; font-weight: 800; font-size: 20px; }

    /* --- LAYOUTS --- */
    .content-area { flex: 1; overflow-y: auto; padding: 0 16px 120px 16px; scroll-behavior: smooth; }
    .tab-view { display: none; }
    .tab-view.active { display: block; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }

    /* --- SHOP --- */
    .item-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 10px; text-align: center; cursor: pointer; position: relative; overflow: hidden; transition: transform 0.1s; }
    .item-card:active { transform: scale(0.95); }
    .item-card.active { border: 2px solid var(--accent); background: rgba(255,255,255,0.1); box-shadow: 0 0 15px rgba(0,0,0,0.05); }
    .mini-ui { width: 100%; height: 40px; border-radius: 10px; margin-bottom: 8px; position: relative; border: 1px solid rgba(0,0,0,0.1); overflow: hidden; display:flex; align-items:center; justify-content:center; font-size: 18px; color: var(--text-sub); }
    .lock-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700; backdrop-filter: blur(2px); z-index: 10; border-radius: 10px; gap: 4px; pointer-events: none; }

    /* --- DOCK --- */
    .dock { 
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
      background: var(--dock-bg); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      padding: 12px 30px; border-radius: 50px; display: flex; gap: 30px; 
      box-shadow: 0 15px 40px rgba(0,0,0,0.15); z-index: 100; 
      border: 1px solid rgba(255,255,255,0.2);
    }
    .dock-btn { font-size: 24px; color: var(--text-sub); cursor: pointer; transition: 0.3s; position: relative; }
    .dock-btn.active { color: var(--accent); transform: translateY(-8px); }
    .dock-btn.active::after { content:''; position: absolute; bottom: -12px; left: 50%; transform: translateX(-50%); width: 5px; height: 5px; background: var(--accent); border-radius: 50%; }

    /* --- CHAT & FRIENDS --- */
    .chat-box { height: 350px; overflow-y: auto; border: 1px solid var(--border); border-radius: 16px; padding: 15px; background: rgba(0,0,0,0.02); display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }
    .chat-msg { padding: 10px 14px; border-radius: 16px; font-size: 13px; max-width: 85%; word-wrap: break-word; line-height: 1.4; }
    .chat-msg a { color: white; text-decoration: underline; }
    .chat-msg.me { align-self: flex-end; background: var(--accent); color: var(--accent-fg); border-bottom-right-radius: 4px; }
    .chat-msg.other { align-self: flex-start; background: var(--bg-card); border: 1px solid var(--border); border-bottom-left-radius: 4px; }
    
    .friend-row { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--bg-card); border-bottom: 1px solid var(--border); }
    .friend-info { display: flex; align-items: center; gap: 10px; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
    .status-dot.online { background: #22c55e; box-shadow: 0 0 5px #22c55e; }
    .status-dot.away { background: #f59e0b; }

    /* --- CAROUSEL --- */
    .avatar-carousel-container { position: relative; perspective: 1000px; height: 120px; display: flex; align-items: center; justify-content: center; margin: 20px 0; }
    .avatar-carousel { display: flex; align-items: center; gap: 20px; transition: transform 0.3s; }
    .avatar-preview { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--accent); overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); background: white; transition: 0.3s; animation: chromaShift 5s infinite; }
    .carousel-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; border-radius: 50%; background: var(--bg-card); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .carousel-btn.left { left: 10px; } .carousel-btn.right { right: 10px; }

    /* --- MODALS --- */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
    .overlay.open { display: flex; }
    .modal { background: var(--bg-card); width: 90%; max-width: 420px; border-radius: 32px; padding: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); max-height: 90vh; overflow-y: auto; }
    
    .chroma-header { background: linear-gradient(45deg, #f59e0b, #ec4899, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: bgShift 5s ease infinite; background-size: 200% 200%; }
    .chroma-border { border: 2px solid transparent; background-image: linear-gradient(var(--bg-card), var(--bg-card)), linear-gradient(45deg, #f59e0b, #ec4899); background-origin: border-box; background-clip: padding-box, border-box; }

    .game-input { width: 100%; font-size: 24px; text-align: center; border: none; background: transparent; color: var(--text); font-weight: 700; margin: 20px 0; outline: none; border-bottom: 2px solid var(--border); padding-bottom: 8px; text-transform: uppercase; }
    .auth-input { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none; font-size: 14px; margin-bottom: 10px; }

    /* --- HELPERS --- */
    .toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
    .toast { background: var(--bg-card); padding: 12px 20px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 10px; font-size: 13px; font-weight: 700; border: 1px solid var(--border); animation: slideUp 0.3s; }
    .toast.success i { color: var(--success); } .toast.error i { color: var(--danger); }

    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin: 15px 0; }
    .cal-day { background: rgba(0,0,0,0.03); border-radius: 10px; padding: 8px 2px; text-align: center; opacity: 0.5; font-size: 10px; border: 1px solid transparent; }
    .cal-day.active { opacity: 1; background: white; border-color: var(--accent); transform: scale(1.1); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .cal-day.claimed { opacity: 1; background: var(--success); color: white; }
  </style>
</head>
<body>

  <div class="toast-container" id="toastContainer"></div>

  <!-- SPLASH -->
  <div id="splash" style="position:fixed; inset:0; background:#0f172a; z-index:999; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; transition:opacity 0.5s;">
    <h1 style="font-family:'Space Grotesk'; letter-spacing:2px; font-size:40px; margin-bottom:10px;">GUESSIT!</h1>
    <p style="opacity:0.6;">v1.31.08F â€¢ Funky Edition</p>
    <div style="margin-top:20px; font-size:12px; display:flex; align-items:center; gap:10px;">
        <i class="fa-solid fa-music"></i> Audio Engine Loading...
    </div>
  </div>

  <div class="app-container" id="app">
    
    <header class="app-header" style="padding: 20px 16px;">
      <div class="header-brand">
        <div class="logo-box">?</div>
        <span style="font-weight:800; font-size:22px;">GuessIt!</span>
      </div>
      <div style="display:flex; gap:8px; margin-left: auto;">
        <div class="currency"><i class="fa-solid fa-coins" style="color:#fbbf24"></i> <span id="uiCoins">0</span></div>
        <div class="currency"><i class="fa-solid fa-gem" style="color:#38bdf8"></i> <span id="uiGems">0</span></div>
      </div>
    </header>

    <div class="content-area">
      
      <!-- TAB: HOME -->
      <div id="tab-home" class="tab-view active">
        <div class="card hero-card">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <h2 style="font-family:'Space Grotesk'">Campaign</h2>
              <p style="font-size:13px; opacity:0.7">Level <span id="lvlDisplay">1</span> / 35</p>
            </div>
            <button class="btn btn-sm" onclick="openMap()"><i class="fa-solid fa-map"></i> Map</button>
          </div>
          <div style="margin-top:15px; height:8px; background:rgba(0,0,0,0.1); border-radius:10px; overflow:hidden;">
            <div id="xpBar" style="width:0%; height:100%; background:var(--accent); border-radius:10px; transition:width 0.5s;"></div>
          </div>
        </div>

        <h3 style="margin: 0 0 10px 5px; font-family:'Space Grotesk'">Missions</h3>
        <div class="card" style="padding:0">
            <div id="missionList"></div>
        </div>
      </div>
      
      <!-- TAB: WORLD -->
      <div id="tab-world" class="tab-view">
        <div class="card" style="padding: 10px;">
          <div style="display:flex; gap:10px;">
              <button class="btn btn-sm btn-primary" id="tabGlobal" onclick="switchChatTab('global')" style="flex:1">Global</button>
              <button class="btn btn-sm btn-ghost" id="tabFriends" onclick="switchChatTab('friends')" style="flex:1">Friends</button>
              <button class="btn btn-sm btn-ghost" id="tabEvents" onclick="switchChatTab('events')" style="flex:1">Events</button>
          </div>
        </div>
        
        <div id="viewGlobal">
            <div class="chat-box" id="globalChat">
               <div class="chat-msg other"><b>System:</b> Welcome to the Funky update! ðŸŽµ</div>
            </div>
            <div style="display:flex; gap:10px;">
               <input type="text" id="chatInput" class="auth-input" placeholder="Type a message..." style="margin:0">
               <button class="btn btn-sm" style="width:auto" onclick="sendChat()"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
        
        <div id="viewFriends" style="display:none;">
            <div class="card chroma-border" style="padding:15px; display:flex; gap:10px; align-items:center;">
                <input type="text" id="addFriendInput" class="auth-input" placeholder="Add by handle (e.g. @player)" style="margin:0; flex:1; border:none;">
                <button class="btn btn-sm" onclick="addFriend()"><i class="fa-solid fa-user-plus"></i></button>
            </div>
            <div id="friendsList" style="display:flex; flex-direction:column; gap:10px;"></div>
        </div>

        <div id="viewEvents" style="display:none; text-align:center;">
            <div class="card hero-card">
                <h2><i class="fa-solid fa-calendar-star"></i> Funky Weekend</h2>
                <p>Double XP & Coins!</p>
                <button class="btn btn-sm" disabled>Starts in 2d</button>
            </div>
        </div>
      </div>

      <!-- TAB: SHOP -->
      <div id="tab-shop" class="tab-view">
         <div class="card">
             <h3>7-Day Streak</h3>
             <div class="cal-grid" id="calendarGrid"></div>
             <button class="btn" id="dailyBtn" onclick="claimDaily()">Claim Reward</button>
         </div>

         <h3 style="margin: 10px 0;">Skins</h3>
         <div class="grid-2" id="skinGrid"></div>
         <h3 style="margin: 20px 0 10px;">Frames</h3>
         <div class="grid-3" id="frameGrid"></div>
      </div>

      <!-- TAB: PROFILE -->
      <div id="tab-profile" class="tab-view">
        <div class="card" style="text-align:center; padding-top:40px; position:relative;">
          <i class="fa-solid fa-gear" style="position:absolute; top:15px; right:15px; cursor:pointer;" onclick="openSettings()"></i>
          <i class="fa-solid fa-pen" style="position:absolute; top:15px; left:15px; cursor:pointer;" onclick="openEditProfile()"></i>
          
          <div class="avatar-frame" id="profileFrame"><img id="profileImg" class="avatar-img" src=""></div>
          <h2 id="profileName">Guest</h2>
          <div id="profileHandle" style="font-size:12px; color:var(--text-sub); margin-bottom:10px;">@guest</div>
          
          <div style="background:rgba(0,0,0,0.05); padding:10px; border-radius:12px; margin-top:15px;">
              <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;">
                  <span id="pRank">Bronze I</span>
                  <span id="xpText">0/100 XP</span>
              </div>
              <div style="height:6px; background:#ddd; border-radius:4px; overflow:hidden;">
                  <div id="rankProgress" style="height:100%; background:var(--accent); width:0%"></div>
              </div>
          </div>
        </div>
        <button class="btn btn-primary" onclick="openLoginModal()" id="loginBtn">Login / Register</button>
        <button class="btn btn-ghost" onclick="logout()" style="margin-top:10px; color:var(--danger); border-color:var(--danger);">Logout</button>
      </div>

    </div>

    <!-- DOCK -->
    <div class="dock">
      <div class="dock-btn active" onclick="nav('home', this)"><i class="fa-solid fa-house"></i></div>
      <div class="dock-btn" onclick="nav('world', this)"><i class="fa-solid fa-earth-americas"></i></div>
      <div class="dock-btn" onclick="nav('shop', this)"><i class="fa-solid fa-bag-shopping"></i></div>
      <div class="dock-btn" onclick="nav('profile', this)"><i class="fa-solid fa-user"></i></div>
    </div>

  </div>

  <!-- MODALS -->
  <div class="overlay" id="gameModal">
    <div class="modal" style="text-align:center;">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <span id="gameMode" style="font-weight:bold; opacity:0.5;">CLASSIC</span>
            <i class="fa-solid fa-xmark" onclick="closeModal('gameModal')" style="cursor:pointer"></i>
        </div>
        <div id="gameTimer" style="font-size:40px; font-weight:900; display:none;">30</div>
        
        <div class="logo-container" id="gameLogoContainer" style="width:160px; height:160px; margin:0 auto 20px auto; border-radius:30px; background:white; display:flex; align-items:center; justify-content:center; box-shadow:0 10px 30px rgba(0,0,0,0.1); overflow:hidden;">
            <img id="gameLogo" src="" style="width:80%; height:80%; object-fit:contain; transition:0.3s;">
        </div>
        
        <input type="text" id="gInput" class="game-input" placeholder="BRAND NAME">
        
        <div class="grid-3" style="margin-bottom:20px;">
            <button class="btn btn-ghost btn-sm" onclick="powerup('hint')"><i class="fa-solid fa-lightbulb"></i> 50c</button>
            <button class="btn btn-ghost btn-sm" onclick="powerup('time')"><i class="fa-solid fa-clock"></i> 100c</button>
            <button class="btn btn-ghost btn-sm" onclick="powerup('skip')"><i class="fa-solid fa-forward"></i> 2g</button>
        </div>
        
        <button class="btn btn-primary" onclick="submitGuess()">SUBMIT</button>
    </div>
  </div>

  <div class="overlay" id="mapModal">
      <div class="modal">
          <h3 style="margin-bottom:20px;">Mission Map</h3>
          <div id="levelGrid" style="display:grid; grid-template-columns:repeat(4,1fr); gap:10px;"></div>
          <button class="btn btn-ghost" style="margin-top:20px; width:100%" onclick="closeModal('mapModal')">Close</button>
      </div>
  </div>

  <div class="overlay" id="editProfileModal">
      <div class="modal">
          <h3 style="margin-bottom:20px;">Edit Profile</h3>
          <input type="text" id="editHandle" class="auth-input" placeholder="@handle" maxlength="15">
          <div class="avatar-carousel-container">
              <div class="carousel-btn left" onclick="cycleAvata